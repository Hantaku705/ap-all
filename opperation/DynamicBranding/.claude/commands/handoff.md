# /handoff - セッション終了時の書き出し

セッション終了時に進捗を HANDOFF.md に**追記**し、コアな実装内容は CLAUDE.md にも反映します。

## 重要：追記型の更新

**HANDOFF.mdは上書きではなく追記で更新する。** 既存の内容を維持しつつ、今回のセッションの変更だけを追加する。

## 実行手順

1. git status で変更ファイルを確認
2. git log -1 で最新コミットを確認
3. **HANDOFF.md を読み込み**、既存の内容を確認
4. **HANDOFF.md を追記更新**（既存内容を維持）:
   - 完了したタスク → 既存リストに**追加**
   - 作業中のタスク → 完了したものは完了に移動、新規は追加
   - 未コミット変更 → 最新のgit statusで**更新**
   - 最新コミット → 最新のgit logで**更新**
   - セッション履歴 → 今回のセッションを**先頭に追加**
5. **フォルダごとのCLAUDE.md を作成/更新**（新規.mdファイルがある場合）
6. **ルートCLAUDE.md を更新**（永続的なプロジェクト知識）
7. **コミット＆プッシュ**（オプション）

## 更新パターン

### 完了したタスク（追加）

```diff
 - [x] 既存のタスク1
 - [x] 既存のタスク2
+- [x] **今回完了したタスク**
```

### セッション履歴（先頭に追加）

```diff
 ## セッション履歴

+### YYYY-MM-DD
+- 今回やったこと1
+- 今回やったこと2
+
 ### 前回の日付
 - 前回やったこと
```

### 未コミット変更（上書き）

```markdown
## 未コミット変更
```
[最新の git status --short の出力]
```
```

### 最新コミット（上書き）

```markdown
## 最新コミット
```
[最新の git log -1 --oneline の出力]
```
```

## .md ファイルのフォルダ化ルール

### 原則

**各 .md ファイルは専用フォルダに格納し、同フォルダ内に CLAUDE.md を配置する。**

### 構造

```
[parent]/
├── CLAUDE.md              ← 親フォルダの説明
└── [filename]/            ← ファイル専用フォルダ
    ├── [filename].md      ← コンテンツ
    └── CLAUDE.md          ← このファイルの説明
```

### 例

```
research/keywords/
├── CLAUDE.md              ← keywords/ 全体の説明
└── sns-keywords/
    ├── sns-keywords.md    ← KW設計書
    └── CLAUDE.md          ← sns-keywords.md の説明
```

### 例外（フォルダ化しない）

- `HANDOFF.md`（ルート直下）
- `CLAUDE.md`（各フォルダ直下）
- `README.md`
- `.claude/commands/*.md`（スキル定義）
- `.claude/agents/*.md`（サブエージェント定義）

---

## CLAUDE.md 更新ガイドライン

### ファイル専用 CLAUDE.md の記載内容

新しい `.md` ファイルを作成したら、そのファイル専用フォルダ内に CLAUDE.md を作成する。

```markdown
# [filename].md - [1行説明]

[このファイルの目的・背景]

---

## 概要

- **作成日**: YYYY-MM-DD
- **作成方法**: [手動 / Claudeが生成 / 外部ツール出力]
- **データソース**: [該当する場合]

---

## 内容

[ファイルの主要セクション・構成を説明]

---

## 関連ファイル

- `../../other-folder/file/file.md` - 関連

---

## 更新履歴

- YYYY-MM-DD: 初版作成
```

### 親フォルダ CLAUDE.md の記載内容

ファイル専用フォルダを作成したら、親フォルダの CLAUDE.md も更新する。

```markdown
# [フォルダ名]/ - [1行説明]

[フォルダの目的]

---

## サブフォルダ一覧

| フォルダ | 説明 |
|---------|------|
| `[filename]/` | [filename].md を格納 |

---

## 関連ファイル

- `../other/folder/file.md` - 関連ファイル

---

## 更新履歴

- YYYY-MM-DD: 変更内容
```

### ルートCLAUDE.md 更新すべき内容

| セッションで行ったこと          | 更新先セクション         |
| ------------------------------- | ------------------------ |
| 新しいページ/コンポーネント追加 | Key Files                |
| 新しいAPIエンドポイント追加     | API Routes               |
| 新しいスキル追加                | カスタムスキル           |
| 新しいDB関数追加                | Common Patterns          |
| バグ修正（重要なもの）          | 解決済みの課題           |
| 新しい環境変数追加              | 環境変数                 |
| DBスキーマ変更                  | データベーススキーマ     |
| ハマったポイント                | よくある間違いと修正     |

### 更新しない内容

- 一時的な作業状態（HANDOFF.mdに記載）
- 未確定の設計（確定後に追加）
- 些細な修正（typo修正など）

## 注意事項

- **絶対に既存の完了タスクを削除しない**
- **セッション履歴は日付順（新しい順）で蓄積**
- 未コミット変更がある場合は git stash を提案
- 次のアクションは具体的に記載
- 問題は原因と対応方針も含める
- CLAUDE.md の更新は永続的な知識のみ
