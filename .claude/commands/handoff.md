# /handoff - セッション終了時の書き出し（ハイブリッド方式）

セッション終了時に進捗を記録。**ルートHANDOFF.mdは軽量（100行以下）、詳細履歴はプロジェクト別HANDOFF.mdに記録。**

---

## 構造

```
AP/
├── HANDOFF.md              # 軽量（現在状態+リンクのみ）
└── projects/
    ├── [project]/HANDOFF.md  # 詳細履歴
    └── ...
```

---

## 実行手順

### Step 1: プロジェクト特定

1. `git status --short` で変更ファイルを取得
2. 変更ファイルから**関連プロジェクト**を特定:
   - `projects/[name]/` → プロジェクト名
   - `opperation/[name]/` → opperationサブフォルダ
   - `NADESHIKO/` → NADESHIKO
   - その他 → ルートのみ更新

### Step 2: プロジェクト別HANDOFF.md更新

該当プロジェクトの`HANDOFF.md`を**追記更新**:

```markdown
### YYYY-MM-DD (Session #N)
- やったこと1
- やったこと2
```

**新規作成時のテンプレート**:

```markdown
# [プロジェクト名] HANDOFF

## 現在の状態

| 項目 | 値 |
|------|-----|
| 本番URL | https://... |
| 最終更新 | YYYY-MM-DD |

## セッション履歴

### YYYY-MM-DD (Session #N)
- 初回作業内容
```

### Step 3: ルートHANDOFF.md更新

**軽量更新のみ**（詳細履歴は書かない）:

1. 最終セッション番号を更新
2. 最終更新日を更新
3. 最新コミットを更新
4. 作業中タスクを更新
5. 未コミット変更を更新
6. プロジェクト別履歴テーブルの最終更新日を更新

### Step 4: CLAUDE.md更新（従来通り）

変更ファイルがあるフォルダのCLAUDE.mdを更新（詳細は後述）。

### Step 5: コミット＆プッシュ（オプション）

---

## ルートHANDOFF.mdフォーマット（目標100行以下）

```markdown
# HANDOFF - セッション引き継ぎ

## 現在の状態

| 項目 | 値 |
|------|-----|
| 最終セッション | #N |
| 最終更新 | YYYY-MM-DD |
| 最新コミット | xxxxxxx |

### 作業中のタスク
- [ ] タスク1
- [ ] タスク2

### 次のアクション
1. アクション1

## 未コミット変更
```
git status出力
```

## プロジェクト別履歴

| プロジェクト | 最終更新 | 本番URL | HANDOFF |
|-------------|---------|---------|---------|
| project1 | YYYY-MM-DD | [URL] | [詳細](projects/project1/HANDOFF.md) |

## 完了サマリー

| フェーズ | 期間 | 主要タスク | 件数 |
|---------|------|-----------|------|
| ... | ... | ... | ... |

## 未解決の問題
- 問題1
```

---

## CLAUDE.md自動更新ルール

### 検出ロジック

1. `git status --short` で変更ファイルを取得
2. 変更ファイルの**全ディレクトリパス**を抽出（重複除去）
3. 各ディレクトリについて:
   - **CLAUDE.mdが存在しない → 新規作成**
   - **CLAUDE.mdが存在する → 更新**
4. 親ディレクトリを辿り、ルートまでのCLAUDE.mdも対象に追加

### 除外対象

- `.git/`, `node_modules/`, `.next/`
- `.claude/commands/`, `.claude/agents/`
- `HANDOFF.md`, `README.md`

### シンプルなCLAUDE.mdテンプレート

```markdown
# [フォルダ名] - [1行説明]

## ファイル一覧

| ファイル | 説明 |
|---------|------|
| `file1.md` | [概要] |

## 更新履歴

- YYYY-MM-DD: 初版作成
```

---

## 注意事項

- **ルートHANDOFF.mdには詳細履歴を書かない**（プロジェクト別に分散）
- **プロジェクト別HANDOFF.mdは追記型**（既存内容を維持）
- CLAUDE.md更新は永続的な知識のみ
- 次のアクションは具体的に記載
