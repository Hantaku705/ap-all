// TikTok Algorithm Data
// Source: algorithm/algorithm.md

export interface TableRow {
  [key: string]: string;
}

export interface AlgorithmContentItem {
  type: 'text' | 'table' | 'code' | 'quote' | 'list';
  title?: string;
  data: string | string[] | { headers: string[]; rows: TableRow[] };
}

export interface AlgorithmSection {
  id: string;
  title: string;
  icon: string;
  description?: string;
  content: AlgorithmContentItem[];
}

export const algorithmData: AlgorithmSection[] = [
  {
    id: 'fyp',
    title: 'アルゴリズムの基本構造',
    icon: '📱',
    description: 'For You Page（FYP）の仕組み',
    content: [
      {
        type: 'code',
        title: 'FYPの流れ',
        data: `投稿 → 初期配信（100-500人）→ 評価 → 拡散 or 停止
         ↓
    エンゲージメント測定
    ・視聴完了率
    ・いいね率
    ・コメント率
    ・シェア率
    ・保存率`,
      },
      {
        type: 'table',
        title: '配信の段階',
        data: {
          headers: ['段階', '配信数', '条件'],
          rows: [
            { 段階: '第1段階', 配信数: '100〜500人', 条件: '投稿直後（フォロワー + 興味関心マッチ）' },
            { 段階: '第2段階', 配信数: '1,000〜5,000人', 条件: '第1段階で高エンゲージメント' },
            { 段階: '第3段階', 配信数: '10,000〜100,000人', 条件: '第2段階で継続的に高評価' },
            { 段階: 'バイラル', 配信数: '100,000人以上', 条件: '複数指標で上位パフォーマンス' },
          ],
        },
      },
    ],
  },
  {
    id: 'metrics',
    title: '重要指標（ランキングシグナル）',
    icon: '📊',
    description: 'アルゴリズムが評価する指標',
    content: [
      {
        type: 'table',
        title: '優先度順',
        data: {
          headers: ['優先度', '指標', '説明', '目標値'],
          rows: [
            { 優先度: '1', 指標: '視聴完了率', 説明: '動画を最後まで見た割合', 目標値: '70%以上' },
            { 優先度: '2', 指標: 'リプレイ率', 説明: '繰り返し視聴された割合', 目標値: '高いほど良い' },
            { 優先度: '3', 指標: 'シェア率', 説明: '他者に共有された割合', 目標値: '1%以上' },
            { 優先度: '4', 指標: 'コメント率', 説明: 'コメントがついた割合', 目標値: '0.5%以上' },
            { 優先度: '5', 指標: 'いいね率', 説明: 'いいねされた割合', 目標値: '5%以上' },
            { 優先度: '6', 指標: '保存率', 説明: '保存された割合', 目標値: '1%以上' },
            { 優先度: '7', 指標: 'フォロー率', 説明: '動画からフォローされた割合', 目標値: '0.5%以上' },
          ],
        },
      },
      {
        type: 'quote',
        title: '視聴完了率の重要性',
        data: 'TikTokは「ユーザーを長くアプリに留める」ことが目的。\n→ 最後まで見られる動画 = ユーザーを留める動画 = 優遇',
      },
    ],
  },
  {
    id: 'moving-average',
    title: '移動平均の法則',
    icon: '📈',
    description: '過去の投稿が次の動画に影響する仕組み',
    content: [
      {
        type: 'quote',
        data: '結局次の動画は前の動画のパフォーマンスを引きずるので、移動平均のようなグラフイメージ',
      },
      {
        type: 'code',
        title: '概念',
        data: `過去7-14本の平均再生数
    ↓
アカウントの「期待値」としてアルゴリズムが認識
    ↓
次の動画の初期配信数に影響`,
      },
      {
        type: 'table',
        title: '影響',
        data: {
          headers: ['状態', '移動平均', '次の動画への影響'],
          rows: [
            { 状態: '好調', 移動平均: '高い', '次の動画への影響': '初期配信数が多い → バズりやすい' },
            { 状態: '低迷', 移動平均: '低い', '次の動画への影響': '初期配信数が少ない → 回復困難' },
          ],
        },
      },
      {
        type: 'table',
        title: '対策',
        data: {
          headers: ['状態', '対策'],
          rows: [
            { 状態: '低迷時', 対策: '企画動画を投下して突破（移動平均リセット）' },
            { 状態: '好調時', 対策: '投稿頻度を維持して勢いを保つ' },
          ],
        },
      },
    ],
  },
  {
    id: 'account-quality',
    title: 'アカウント質スコア',
    icon: '⭐',
    description: 'アカウントの信頼性と最適化',
    content: [
      {
        type: 'quote',
        data: '投稿アカウントのおすすめ欄がターゲットと同じなら理想\n\nTikTokは「このアカウントはどんなジャンルのアカウントか」を視聴行動から判断している。\n→ 美容アカウントなら、おすすめ欄が美容動画で埋まっている状態が理想。',
      },
      {
        type: 'table',
        title: '構成要素',
        data: {
          headers: ['要素', '説明', '改善方法'],
          rows: [
            { 要素: 'アカウント年齢', 説明: '古いほど信頼性UP', 改善方法: '時間' },
            { 要素: '投稿頻度', 説明: '継続的な投稿', 改善方法: '毎日投稿' },
            { 要素: 'エンゲージメント履歴', 説明: '過去の平均パフォーマンス', 改善方法: '高品質動画' },
            { 要素: '視聴行動', 説明: 'アカウント自体の視聴パターン', 改善方法: '1日30分視聴' },
            { 要素: 'コミュニティ参加', 説明: 'コメント・いいね活動', 改善方法: '積極的に交流' },
            { 要素: 'おすすめ欄の状態', 説明: 'ターゲットジャンルの動画で埋まっているか', 改善方法: 'ジャンル動画を見続ける' },
          ],
        },
      },
      {
        type: 'quote',
        title: '新規アカウントの育成',
        data: '最初の2週間はターゲットの動画を見まくる\n\n1-2週目: ターゲットジャンルの動画を視聴し続ける → おすすめ欄をターゲット層と同じ状態に\n3週目〜: 投稿開始 → ジャンル認定されたアカウントからの投稿',
      },
      {
        type: 'table',
        title: 'アカウントがダメな場合',
        data: {
          headers: ['兆候', '対応'],
          rows: [
            { 兆候: '再生数が継続的に低い', 対応: '新規アカウント作成を検討' },
            { 兆候: 'おすすめ欄がターゲットと違う', 対応: '新規アカウント作成' },
            { 兆候: 'シャドウバンの疑い', 対応: '新規アカウント作成' },
          ],
        },
      },
    ],
  },
  {
    id: 'device-network',
    title: 'デバイス・ネットワークの影響',
    icon: '📡',
    description: '1スマホ1アカウント、WiFiバン連鎖',
    content: [
      {
        type: 'quote',
        title: '1スマホ1アカウントの原則',
        data: '同じスマホで複数アカウント登録はやめるべき\n\nスマホにA・B両アカウント登録 → Aで見た動画がBのおすすめに連動\n結果: アカウントのジャンル特性が混ざる\n\n推奨: 1アカウント = 1スマホ',
      },
      {
        type: 'quote',
        title: 'WiFiの影響（バン連鎖）',
        data: '同じWiFi下でバンが発生すると、他のアカウントも影響を受ける\n\n同一WiFiでアカウントAがバン → 同一WiFiのアカウントB・Cもバン対象になりやすい',
      },
      {
        type: 'table',
        title: '対策',
        data: {
          headers: ['対策', '説明'],
          rows: [
            { 対策: 'WiFi分離', 説明: 'アカウントごとに異なるネットワークを使用' },
            { 対策: 'モバイル回線', 説明: '重要アカウントはモバイル回線を使用' },
            { 対策: 'VPN', 説明: '必要に応じてIPを分散（※TikTokのVPN検知に注意）' },
          ],
        },
      },
    ],
  },
  {
    id: 'content-optimization',
    title: 'コンテンツ最適化',
    icon: '🎬',
    description: '動画構成とテクニック',
    content: [
      {
        type: 'code',
        title: '動画構成の黄金律',
        data: `0-1秒: フック（Hook）     → 離脱防止
1-3秒: 価値提示（Value）  → 期待形成
3秒-: 本編（Content）     → 視聴維持
最後: CTA（Call to Action）→ エンゲージメント誘導`,
      },
      {
        type: 'table',
        title: 'フックのパターン',
        data: {
          headers: ['パターン', '例'],
          rows: [
            { パターン: '質問型', 例: '「〇〇って知ってる？」' },
            { パターン: '驚き型', 例: '「これ見て！」「やばい」' },
            { パターン: '問題提起型', 例: '「〇〇で悩んでない？」' },
            { パターン: '結果先出し型', 例: 'ビフォーアフターを最初に見せる' },
            { パターン: '対立型', 例: '「〇〇 vs △△」' },
          ],
        },
      },
      {
        type: 'table',
        title: '視聴完了率を上げるテクニック',
        data: {
          headers: ['テクニック', '説明'],
          rows: [
            { テクニック: 'ループ動画', 説明: '終わりと始まりを繋げて繰り返し視聴させる' },
            { テクニック: 'テンポ感', 説明: '間延びしない編集（ジャンプカット）' },
            { テクニック: 'テキスト', 説明: '音なしでも理解できる字幕' },
            { テクニック: '期待感', 説明: '「最後に衝撃」など煽り' },
            { テクニック: '短尺', 説明: '15-30秒が最適（完了率上げやすい）' },
          ],
        },
      },
    ],
  },
  {
    id: 'posting-timing',
    title: '投稿タイミング',
    icon: '⏰',
    description: '最適な投稿時間と曜日',
    content: [
      {
        type: 'table',
        title: '最適な投稿時間',
        data: {
          headers: ['時間帯', '特徴'],
          rows: [
            { 時間帯: '7:00-9:00', 特徴: '通勤・通学時間' },
            { 時間帯: '12:00-13:00', 特徴: '昼休み' },
            { 時間帯: '18:00-21:00', 特徴: '帰宅後（ゴールデンタイム）' },
            { 時間帯: '22:00-24:00', 特徴: '就寝前' },
          ],
        },
      },
      {
        type: 'table',
        title: '曜日',
        data: {
          headers: ['曜日', '傾向'],
          rows: [
            { 曜日: '平日', 傾向: '安定したリーチ' },
            { 曜日: '金〜日', 傾向: '閲覧時間が長い（バズりやすい）' },
          ],
        },
      },
    ],
  },
  {
    id: 'hashtags',
    title: 'ハッシュタグ戦略',
    icon: '#️⃣',
    description: 'タグの種類と最適な数',
    content: [
      {
        type: 'table',
        title: '構成',
        data: {
          headers: ['タイプ', '例', '目的'],
          rows: [
            { タイプ: 'ビッグ（100万+）', 例: '#美容 #コスメ', 目的: '露出拡大' },
            { タイプ: 'ミドル（10万-100万）', 例: '#スキンケア紹介', 目的: 'ターゲット絞り込み' },
            { タイプ: 'スモール（1万-10万）', 例: '#〇〇レビュー', 目的: 'ニッチ層獲得' },
            { タイプ: 'トレンド', 例: 'その時のトレンドタグ', 目的: 'アルゴリズムブースト' },
          ],
        },
      },
      {
        type: 'quote',
        title: '推奨数',
        data: '3〜5個が最適\n多すぎるとスパム判定リスク',
      },
    ],
  },
  {
    id: 'shadowban',
    title: 'シャドウバンと回避',
    icon: '🚫',
    description: '兆候、原因、回避策、5^6理論',
    content: [
      {
        type: 'table',
        title: 'シャドウバンの兆候',
        data: {
          headers: ['兆候', '説明'],
          rows: [
            { 兆候: '再生数が急激に減少', 説明: '通常の1/10以下' },
            { 兆候: 'FYPに表示されない', 説明: 'フォロワーにしか届かない' },
            { 兆候: 'ハッシュタグ検索で出ない', 説明: '検索結果から除外' },
          ],
        },
      },
      {
        type: 'table',
        title: '原因',
        data: {
          headers: ['原因', '説明'],
          rows: [
            { 原因: 'コミュニティガイドライン違反', 説明: '過激なコンテンツ' },
            { 原因: 'スパム行為', 説明: '大量フォロー/いいね' },
            { 原因: '著作権違反', 説明: '音楽・映像の無断使用' },
            { 原因: '同一コンテンツ重複', 説明: '同じ動画を複数投稿' },
          ],
        },
      },
      {
        type: 'table',
        title: '回避策',
        data: {
          headers: ['対策', '説明'],
          rows: [
            { 対策: 'オリジナル音源使用', 説明: '著作権フリー音源 or TikTok提供音源' },
            { 対策: '動画の差別化', 説明: '反転、カット、順番入れ替え（アルゴリズム回避）' },
            { 対策: '自然なエンゲージメント', 説明: '急激なフォロー増を避ける' },
            { 対策: 'ガイドライン遵守', 説明: '過激表現を避ける' },
          ],
        },
      },
      {
        type: 'quote',
        title: '5^6理論（素材組み合わせ戦略）',
        data: '同じ動画や素材を使ったらおすすめに乗りにくくなる\n→ 同じ素材でも複数組み合わせるとバン率が下がる',
      },
      {
        type: 'code',
        title: '5^6理論の計算',
        data: `30秒動画 = 6シーン（5秒×6）
各シーンに5種類の素材を用意
→ 組み合わせパターン = 5^6 = 15,625通り`,
      },
      {
        type: 'table',
        title: '5^6の効果',
        data: {
          headers: ['方式', 'バン率', '通過率'],
          rows: [
            { 方式: '同一素材そのまま', バン率: '高い', 通過率: '低い' },
            { 方式: '5^6組み合わせ', バン率: '低い', 通過率: '約60%' },
          ],
        },
      },
      {
        type: 'quote',
        title: 'アーカイブの無意味さ',
        data: '投稿したらデータとして保存されるので、アーカイブしても意味がない\n\n一度投稿した動画のデータはTikTok側に残るため、アーカイブは「見えなくする」だけで、アルゴリズム上の履歴はリセットされない。',
      },
    ],
  },
  {
    id: 'tiktok-shop',
    title: 'TikTok Shop（TTS）',
    icon: '🛒',
    description: 'GMV MAX、初動ハック、ライブコマース',
    content: [
      {
        type: 'code',
        title: 'GMV MAXの仕組み',
        data: `商品タグ付き動画
    ↓
購入発生 → アルゴリズムが「売れる動画」と認識
    ↓
さらに配信拡大（好循環）`,
      },
      {
        type: 'table',
        title: '初動ハック',
        data: {
          headers: ['ステップ', '内容'],
          rows: [
            { ステップ: '1', 内容: '身内に20件購入依頼' },
            { ステップ: '2', 内容: 'コメントで商品FAQ化（スクリプト用意）' },
            { ステップ: '3', 内容: '毎日コメント返信でエンゲージメント維持' },
          ],
        },
      },
      {
        type: 'quote',
        title: '低品質動画の排除',
        data: '顔出ししてないからヒットしない、というわけではない\n\nTikTok Shopでは低品質動画の排除を行っており、複雑な認識モデルが組まれている。\n\n排除対象: 顔出しなし、静止画、AI読み上げ、非ネイティブ動画',
      },
      {
        type: 'quote',
        title: 'ライブコマースの成功条件',
        data: 'ライブコマースはおすすめ欄に乗るかどうかが全て\n\nライブ中のエンゲージメントがリアルタイムで評価され、おすすめ掲載が決まる。\n\n決定要因: 同接数、いいね数、コメント数、購入数',
      },
      {
        type: 'code',
        title: '初動5-10分の密度形成',
        data: `ライブ開始
    ↓
5-10分: 高密度エンゲージメント（同接・いいね・コメント・購入）
    ↓
TikTokが「盛り上がっているライブ」と認識
    ↓
おすすめ欄に掲載
    ↓
さらに視聴者増加（好循環）`,
      },
      {
        type: 'table',
        title: '初動ハックの方法',
        data: {
          headers: ['施策', '内容'],
          rows: [
            { 施策: '身内動員', 内容: 'ライブ開始直後に社内メンバー/知人で同接確保' },
            { 施策: 'コメント仕込み', 内容: '事前に質問・コメントを用意' },
            { 施策: '即購入', 内容: '開始直後に身内購入で「売れているライブ」演出' },
            { 施策: 'いいね連打', 内容: '参加者全員でいいね' },
          ],
        },
      },
      {
        type: 'quote',
        title: 'レビュー施策',
        data: '星4.5以上、最新レビューがある状態がCVRを大きく左右する\n\n・星4.5以上 + 最新レビューあり → 高い\n・星4.5以上 + レビューなし/古い → 中程度\n・星4.0以下 → 低い\n・レビュー0件 → 最も低い',
      },
      {
        type: 'quote',
        title: '分散型販売モデル',
        data: '1人のインフルエンサーで大量販売 vs 100人で100個販売\n→ 後者の方がリスク分散・安定収益につながる\n\n集中型: 1人で1,000個販売 → インフルエンサー依存、単価交渉力低下\n分散型: 100人で各10個販売 → リスク分散、複数経路、安定収益',
      },
      {
        type: 'table',
        title: 'アフィリエイト手数料体系',
        data: {
          headers: ['項目', '目安'],
          rows: [
            { 項目: 'TikTok Shop手数料', 目安: '約5%（カテゴリにより変動）' },
            { 項目: 'アフィリエイト報酬', 目安: '売上の10-20%（商品・交渉による）' },
            { 項目: '代理店マージン', 目安: '約10%（ゼロプラス等）' },
          ],
        },
      },
      {
        type: 'table',
        title: 'TikTok Shop成功の3条件',
        data: {
          headers: ['条件', '内容'],
          rows: [
            { 条件: '商品力', 内容: '価格競争力、話題性、レビュー' },
            { 条件: '演者力', 内容: 'ライブ配信スキル、ファン基盤' },
            { 条件: '運用力', 内容: '初動ハック、密度形成、継続投稿' },
          ],
        },
      },
    ],
  },
  {
    id: 'search-seo',
    title: '検索アルゴリズム（SEO）',
    icon: '🔍',
    description: 'TikTok検索の攻略',
    content: [
      {
        type: 'quote',
        data: 'TikTokは「検索エンジン」としても使われている（特にGen Z）',
      },
      {
        type: 'table',
        title: '検索順位の決定要因',
        data: {
          headers: ['要因', '説明'],
          rows: [
            { 要因: 'キャプション', 説明: '検索キーワードを含める' },
            { 要因: '音声認識', 説明: '動画内で話した言葉も認識' },
            { 要因: 'テキスト', 説明: '動画内テロップも認識' },
            { 要因: 'エンゲージメント', 説明: '検索結果からのクリック率・視聴完了率' },
          ],
        },
      },
      {
        type: 'table',
        title: '対策',
        data: {
          headers: ['対策', '内容'],
          rows: [
            { 対策: '検索上位コンテンツを真似る', 内容: '構成・キーワードを参考に' },
            { 対策: 'キーワード入れ込み', 内容: 'キャプション + 音声 + テロップ' },
            { 対策: '回答型コンテンツ', 内容: '「〇〇とは」「〇〇のやり方」' },
          ],
        },
      },
    ],
  },
  {
    id: 'analytics',
    title: '分析と改善',
    icon: '📉',
    description: 'TikTok Analyticsの活用',
    content: [
      {
        type: 'table',
        title: 'TikTok Analyticsで見るべき指標',
        data: {
          headers: ['指標', '説明', '目標'],
          rows: [
            { 指標: '視聴完了率', 説明: '最重要指標', 目標: '70%以上' },
            { 指標: '平均視聴時間', 説明: '動画の何秒まで見られたか', 目標: '動画の80%以上' },
            { 指標: 'トラフィックソース', 説明: 'FYP / フォロー / 検索 / その他', 目標: 'FYP比率50%以上' },
            { 指標: 'フォロワー増減', 説明: '投稿ごとの増減', 目標: '純増維持' },
          ],
        },
      },
      {
        type: 'code',
        title: 'PDCAサイクル',
        data: `1. 投稿
    ↓
2. 24-48時間後にAnalytics確認
    ↓
3. 視聴完了率・トラフィックソース分析
    ↓
4. 次の投稿で改善`,
      },
    ],
  },
  {
    id: 'nadeshiko-actions',
    title: 'NADESHIKOへの適用',
    icon: '🎯',
    description: '優先アクションリスト',
    content: [
      {
        type: 'table',
        title: '優先アクション',
        data: {
          headers: ['優先度', 'アクション', '目的'],
          rows: [
            { 優先度: '1', アクション: '視聴完了率70%以上を目指す', 目的: 'アルゴリズム優遇' },
            { 優先度: '2', アクション: '移動平均が下がったら企画動画投下', 目的: '再生数回復' },
            { 優先度: '3', アクション: '1日30分視聴でアカウント質UP', 目的: 'アルゴリズムスコア向上' },
            { 優先度: '4', アクション: '検索上位コンテンツを真似る', 目的: '検索流入増加' },
            { 優先度: '5', アクション: 'TTS初動ハック実行', 目的: 'GMV MAX獲得' },
          ],
        },
      },
      {
        type: 'list',
        title: '参照資料',
        data: [
          'issue/ksf.md: NADESHIKO KSF（本質分析）',
          'issue/issue.md: 週次ミーティング記録',
          'Phone Farm: https://phonefarm-threat-intel.vercel.app/',
        ],
      },
    ],
  },
];
